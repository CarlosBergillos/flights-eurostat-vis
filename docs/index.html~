<html>
<script src="libs/d3.v3.5.17.min.js"></script>
<script src="libs/topojson.3.0.2.min.js"></script>
<script src="libs/datamaps.world.hires.min.js"></script>

<body bgcolor="#182633">
    <div id="container" style="position: relative; width: 100%; height: 100%;"></div>
</body>
<script>

function parseCSV(input) {
    var rows = input.split(/\r?\n/);
    var keys = rows.shift().split(",");
    return rows.map(function(row) {
        return row.split(",").reduce(function(map, val, i) {
            map[keys[i]] = val;
            return map;
        }, {});
    })
}

function toArcs(input) {
    var arcs = []
    input.map(function(row) {
        if(Object.entries(row).length > 1){
            var data = {}
            var from = {"latitude":row["airpt_dep_lat"], "longitude":row["airpt_dep_lon"]}
            var to = {"latitude":row["airpt_arr_lat"], "longitude":row["airpt_arr_lon"]}
            var options = {strokeWidth: 2, strokeColor: 'rgba(221, 28, 119, 0.3)'}
            data = {"origin": from, "destination": to, "options": options}
            arcs.push(data)
        }
    })
    return arcs
}


function toBubbles(input) {
    var bubbles = []
    input.map(function(row) {
        if(Object.entries(row).length > 1){
            options = {"borderWidth": 0}
            data = {"radius": 3, "name": row["airpt_arr"], "latitude":row["airpt_arr_lat"], "longitude":row["airpt_arr_lon"], "borderWidth": 0, defaultFillColor: '#f00', fillOpacity: 1}
            bubbles.push(data)
        }
    })
    return bubbles
}

var map = new Datamap({
    element: document.getElementById('container'),
    geographyConfig: {
        popupOnHover: true,
        highlightOnHover: true,
        borderColor: '#444',
        borderWidth: 0.5,
    },
    fills: {
        defaultFill: '#131522'
    },
    responsive: false
});


<!--fetch('data/LEBL_destinations_pax_2018.csv', {mode: 'no-cors'})-->
fetch('https://cbergillos.com/ES-eurostat-data-visualization/data/LEBL_destinations_pax_2018.csv')
    .then(response => response.text())
    .then(text => {
        jsonArray = parseCSV(text)
        map.bubbles(toBubbles(jsonArray))
        map.arc(toArcs(jsonArray), {greatArc: true,animationSpeed: 600});
        <!--console.log(parseCSV(text))-->
})

</script>
<html>
