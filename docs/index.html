<head>
  <link rel="stylesheet" type="text/css" href="style.css">
  <link rel="stylesheet" type="text/css" href="css/materialize.css"  media="screen,projection"/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
  <script src="https://code.jquery.com/jquery-2.2.3.js" integrity="sha256-laXWtGydpwqJ8JA+X9x2miwmaiKhn8tVmOVEigRNtP4=" crossorigin="anonymous"></script>
  <script src="js/d3.v4.min.js"></script>
  <script>
    d3v4 = d3
    window.d3 = null
  </script>
  <script src="js/d3.v3.5.17.min.js"></script>
  <script src="js/topojson.3.0.2.min.js"></script>
  <script src="js/datamaps.world.hires.custom.js"></script>
  <script src="https://code.jquery.com/jquery-2.2.3.js" integrity="sha256-laXWtGydpwqJ8JA+X9x2miwmaiKhn8tVmOVEigRNtP4=" crossorigin="anonymous"></script>
  <script src="js/defiant.min.js"></script>
  <script>
    d3v3 = d3
    window.d3 = null
  </script>
  <script src="js/materialize.min.js" type="text/javascript"></script>
  <script> 
    $(function(){
      $("#mapContent").load("map.html");
      $("#lowerContent").load("bars.html");
    });
  </script> 

  <ul id="slide-out" class="sidenav sidenav-fixed collection with-header" style="width: 310px;">
    <li class="collection-header blue-grey lighten-5"><h4>Airports</h4></li>
  </ul>
  <script>
    var current_airport = "LEBL"
    var current_year = 2018

    function updateInfo(animate){
      updateMapInfo(this_datamap, animate, current_airport, current_year);
      updateBarsInfo(current_airport);
    }

    var ul = d3v4.select("#slide-out")
    d3v4.json('data/local_airports.json', function(json) {
      ul.selectAll('a')
        .data(json)
        .enter()
        .append('a')
        .attr('class','collection-item blue-grey-text text-darken-2')
        .attr('href','#!')
        .html(function(d){return '<b>'+d.name+'</b><br><p style="font-family: monospace;">'+d.iata+'</p>';})
        //.html(function(d){return "<b>"+d.name+"</b><br>"+d.iata+" / "+d.airpt;})
        .each(function(d){
          var $this = d3v4.select(this);
          if(d.airpt==current_airport)
            $this.attr('class', 'collection-item active deep-orange lighten-1');
        })
        .on("click", function(d){
          var $this = d3v4.select(this);
          ul.selectAll('a').attr('class','collection-item blue-grey-text text-darken-2');
          $this.attr('class','collection-item active deep-orange lighten-1');
          current_airport = d.airpt;
          updateInfo(true);
        });
    });

    document.addEventListener('DOMContentLoaded', function() {
      var elems = document.querySelectorAll('.dropdown-trigger');
      var instances = M.Dropdown.init(elems, {"constrainWidth":false, "coverTrigger":false, "hover":true});
      var instance = M.Dropdown.getInstance(elems[0]);
      //instance.open();
    });

  </script>
  <div class="main">
    <div class="wrapper" id="mapContent">
      <div class="push"></div>
    </div>
    <!-- Dropdown Trigger -->
    <a class="dropdown-trigger btn-small deep-orange lighten-1" style="position: absolute; z-index: 1; bottom:220px; margin:10px" href="#" data-target="dropdown1"><i class="material-icons left">people</i>Number of Passengers</a>
    <!-- Dropdown Structure -->
    <ul id="dropdown1" class="dropdown-content" style="position: absolute; z-index: 1; top:0px; margin:10px;">
      <li><a href="#!"><i class="material-icons">flight_takeoff</i>Number of Flights</a></li>
      <li class="divider" tabindex="-1"></li>
      <li><a href="#!"><i class="material-icons">people</i>Number of Passengers</a></li>
      <li class="divider" tabindex="-1"></li>
      <li><a href="#!"><i class="material-icons">public</i>CO2 emissions (kg)</a></li>
    </ul>
    <div class="lower" id="lowerContent"></div>
  </div>
</body>
